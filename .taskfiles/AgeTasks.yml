---
version: "3"

vars:
  AGE_FILENAME: K3s-Flux.agekey
  AGE_EXPORT_PATH: ~/.config/sops/age

tasks:
  init:
    desc: Ensure `Age` Key is created and sourced.
    deps:
      - .create
      - .direnv

  .create:
    cmds:
      - age-keygen -o {{.AGE_FILENAME}}
      - mv {{.AGE_FILENAME}} {{.AGE_EXPORT_PATH}}/{{.AGE_FILENAME}}
    status:
      - test -f {{.AGE_EXPORT_PATH}}/{{.AGE_FILENAME}}

  .direnv:
    cmds:
      - direnv allow .envrc
